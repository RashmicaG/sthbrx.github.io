<!DOCTYPE html>
<html lang="en">
<head>
          <title>Store Half Byte-Reverse Indexed</title>
        <meta charset="utf-8" />
        <link href="https://sthbrx.github.io/atom.xml" type="application/atom+xml" rel="alternate" title="Store Half Byte-Reverse Indexed Full Atom Feed" />
        <link href="https://sthbrx.github.io/rss.xml" type="application/rss+xml" rel="alternate" title="Store Half Byte-Reverse Indexed RSS Feed" />


    <meta name="tags" content="S822LC for hpc" />
    <meta name="tags" content="hpc" />
    <meta name="tags" content="centos" />
    <meta name="tags" content="centos7" />
    <meta name="tags" content="p8" />
    <meta name="tags" content="bmc" />
    <meta name="tags" content="RHEL" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://sthbrx.github.io/">Store Half Byte-Reverse Indexed <strong>A Power Technical Blog</strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="https://sthbrx.github.io/blog/2017/01/30/installing-centos-72-on-ibm-power-systems-s822lc-for-high-performance-computing-minksy-with-usb-device/" rel="bookmark"
         title="Permalink to Installing Centos 7.2 on IBM Power System's S822LC for High Performance Computing (Minksy) with USB device">Installing Centos 7.2 on IBM Power System's S822LC for High Performance Computing (Minksy) with USB device</a></h2>
 
  </header>
  <footer class="post-info">
    <time class="published" datetime="2017-01-30T08:54:33+11:00">
      Mon 30 January 2017
    </time>
    <address class="vcard author">
      By           <a class="url fn" href="https://sthbrx.github.io/author/daniel-black.html">Daniel Black</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <h2>Introduction</h2>
<p>If you are installing Linux on your IBM Power System's S822LC server then the instructions in this article will help you to start and run your system.  These instructions are specific to installing CentOS 7 on an IBM Power System S822LC for High Performance Computing (Minsky), but also work for RHEL 7 - just swap CentOS for RHEL.</p>
<h3>Prerequisites</h3>
<p>Before you power on the system, ensure that you have the following items:</p>
<ul>
<li>Ethernet cables;</li>
<li>USB storage device of 7G or greater;</li>
<li>An installed ethernet network with a DHCP server;</li>
<li>Access to the DHCP server's logs;</li>
<li>Power cords and outlet for your system;</li>
<li>PC or notebook that has IPMItool level 1.8.15 or greater; and </li>
<li>a VNC client.</li>
</ul>
<p>Download CentOS ISO file from the <a href="http://mirror.centos.org/altarch/7/isos/ppc64le/">Centos Mirror</a>. Select the "Everything" ISO file.</p>
<p>Note: You must use the 1611 release (dated 2016-12-22) or later due to Linux Kernel support for the server hardware.</p>
<h2>Step 1: Preparing to power on your system</h2>
<p>Follow these steps to prepare your system:</p>
<ol>
<li>If your system belongs in a rack, install your system into that rack. For instructions, see IBM POWER8 Systems information.</li>
<li>Connect an Ethernet cable to the left embedded Ethernet port next to the serial port on the back of your system and the other end to your network. This Ethernet port is used for the BMC/IPMI interface.</li>
<li>Connect another Enternet cable to the right Ethernet port for network connection for the operating system.</li>
<li>Connect the power cords to the system and plug them into the outlets. </li>
</ol>
<p>At this point, your firmware is booting.</p>
<h2>Step 2: Determining the BMC firmware IP address</h2>
<p>To determine the IP address of the BMC, examine the latest DHCP server logs for the network connected to the server. The IP address will be requested approximately 2 minutes after being powered on.</p>
<p>It is possible to set the BMC to a static IP address by following the <a href="https://www.ibm.com/support/knowledgecenter/en/TI0003H/p8eih/p8eih_managing_with_ipmi_ami.htm">IBM documentation on IPMI</a>.</p>
<h2>Step 3: Connecting to the BMC firmware with IPMItool</h2>
<p>After you have a network connection set up for your BMC firmware, you can connect using Intelligent Platform Management Interface (IPMI).  IPMI is the default console to use when connecting to the Open Power Abstraction Layer (OPAL) firmware.</p>
<p>Use the default authentication for servers over IPMI is:</p>
<ul>
<li>Default user: ADMIN </li>
<li>Default password: admin </li>
</ul>
<p>To power on your server from a PC or notebook that is running Linux®, follow these steps:</p>
<p>Open a terminal program on your PC or notebook with <a href="#active-sol-ipmi">Activate Serial-Over-Lan using IPMI</a>. Use other steps here as needed.</p>
<p>For the following impitool commands, server_ip_address is the IP address of the BMC from Step 2, and ipmi_user and ipmi_password are the default user ID and password for IPMI.</p>
<h3>Power On using IPMI</h3>
<p>If your server is not powered on, run the following command to power the server on:</p>
<div class="highlight"><pre><span></span>ipmitool -I lanplus -H server_ip_address -U ipmi_user -P ipmi_password chassis power on
</pre></div>


<h3><a name="active-sol-ipmi"></a>Activate Serial-Over-Lan using IPMI</h3>
<p>Activate your IPMI console by running this command:</p>
<div class="highlight"><pre><span></span>ipmitool -I lanplus -H server_ip_address -U ipmi_user -P ipmi_password sol activate
</pre></div>


<p>After powering on your system, the Petitboot interface loads. If you do not interrupt the boot process by pressing any key within 10 seconds, Petitboot automatically boots the first option. At this point the IPMI console will be connected to the Operating Systems serial. If you get to this stage accidently you can deactivate and reboot as per the following two commands.</p>
<h3>Deactivate Serial-Over-Lan using IPMI</h3>
<p>If you need to power off or reboot your system, deactivate the console by running this command:</p>
<div class="highlight"><pre><span></span>ipmitool -I lanplus -H server_ip_address -U user-name -P ipmi_password sol deactivate
</pre></div>


<h3>Reboot using IPMI</h3>
<p>If you need to reboot the system, run this command: </p>
<div class="highlight"><pre><span></span>ipmitool -I lanplus -H server_ip_address -U user-name -P ipmi_password chassis power reset
</pre></div>


<h2>Step 4: Creating a USB device and booting</h2>
<p>At this point, your IPMI console should be contain a Petitboot bootloader menu as illustrated below and you are ready to install Centos 7 on your server.</p>
<p><img alt="Petitboot menu over IPMI" src="/images/centos7-minsky/petitboot-centos7-usb-topmenu.png"> </p>
<p>Use one of the following USB devices:</p>
<ul>
<li>USB attached DVD player with a single USB cable to stay under 1.0 Amps, or</li>
<li>7 GB (or more) 2.0 (or later) USB flash drive. </li>
</ul>
<p>Follow the following instructions:</p>
<ol>
<li>To create the bootable USB device, follow the instructions in the CentOS wiki <a href="https://wiki.centos.org/HowTos/InstallFromUSBkey">Host to Set Up a USB to Install CentOS</a>.</li>
<li>Insert your bootable USB device into the front USB port. CentOS AltArch installer will automatically appear as a boot option on the Petitboot main screen. If the USB device does not appear select <em>Rescan devices</em>. If your device is not detected, you might have to try a different type.</li>
<li>Arrow up to select the CentOS boot option. Press <em>e</em> (Edit) to open the Petitboot Option Editor window</li>
<li>Move the cursor to the Boot arguments section and to include the following information: <code>ro inst.stage2=hd:LABEL=CentOS_7_ppc64le:/ console=hvc0 ip=dhcp</code> (if using RHEL the LABEL will be similar to <code>RHEL-7.3\x20Server.ppc64le:/</code>)</li>
</ol>
<p><img alt="Petitboot edited &quot;Install CentOS AltArch 7 (64-bit kernel)" src="/images/centos7-minsky/petitboot-centos7-usb-option-editor-menu.png"></p>
<p>Notes about the boot arguments:   </p>
<ul>
<li><code>ip=dhcp</code> to ensure network is started for VNC installation.</li>
<li><code>console hvc0</code> is needed as this is not the default.</li>
<li><code>inst.stage2</code> is needed as the boot process won't automatically find the stage2 install on the install disk.</li>
<li>append <code>inst.proxy=URL</code> where URL is the proxy URL if installing in a network that requires a proxy to connect externally.</li>
</ul>
<p>You can find additional options at <a href="https://rhinstaller.github.io/anaconda/boot-options.html">Anaconda Boot Options</a>.</p>
<ol>
<li>Select <em>OK</em> to save your options and return to the Main menu </li>
<li>On the Petitboot main screen, select the CentOS AltArch option and then press <em>Enter</em>. </li>
</ol>
<h2>Step 5: Complete your installation</h2>
<p>After you select to boot the CentOS installer, the installer wizard walks you through the steps.  </p>
<ol>
<li>If the CentOS installer was able to obtain a network address via DHCP, it will present an option to enable the VNC. If no option is presented check your network cables. <img alt="VNC option" src="/images/centos7-minsky/anaconda-centos7-text-start.png"></li>
<li>Select the <em>Start VNC</em> option and it will provide an OS server IP adress. Note that this will be different to the BMC address previously optained. <img alt="VNC option selected" src="/images/centos7-minsky/anaconda-centos7-vnc-selected.png"></li>
<li>Run a VNC client program on your PC or notebook and connect to the OS server IP address.</li>
</ol>
<p><img alt="VNC of Installer" src="/images/centos7-minsky/anaconda-centos7-vnc-start.png"></p>
<p>During the install over VNC, there are a couple of consoles active. To switch between them in the ipmitool terminal, press <em>ctrl-b</em> and then between <em>1</em>-<em>4</em> as indicated.</p>
<p>Using the VNC client program:</p>
<ol>
<li>Select "Install Destination"</li>
<li>Select a device from "Local Standard Disks"</li>
<li>Select "Full disk summary and boot device"</li>
<li>Select the device again from "Selected Disks" with the Boot enabled</li>
<li>Select "Do not install boot loader" from device. <img alt="Disabling install of boot loader" src="/images/centos7-minsky/anaconda-centos7-vnc-installation-destination-do-not-install-boot-loader.png"> which results in <img alt="Result after disabling boot loader install" src="/images/centos7-minsky/anaconda-centos7-vnc-installation-destination-do-not-install-boot-loader-result.png">.</li>
</ol>
<p>Without disabling boot loader, the installer complains about <code>an invalid stage1 device</code>. I suspect it needs a manual Prep partition of 10M to make the installer happy.</p>
<p>If you have a local Centos repository  you can set this by selecting "Install Source" - the directories at this url should look like <a href="http://mirror.centos.org/altarch/7/os/ppc64le/">CentOS's Install Source for ppc64le</a>.</p>
<h2>Step 6: Before reboot and using the IPMI Serial-Over-LAN</h2>
<p>Before reboot, generate the grub.cfg file as Petitboot uses this to generate its boot menu: </p>
<ol>
<li>Using the ipmitool's shell (<em>ctrl-b 2</em>):</li>
<li>Enter the following commands to generate a grub.cfg file</li>
</ol>
<div class="highlight"><pre><span></span>chroot /mnt/sysimage
rm /etc/grub.d/30_os-prober
grub2-mkconfig -o /boot/grub2/grub.cfg
exit
</pre></div>


<p><code>/etc/grub.d/30_os-prober</code> is removed as Petitboot probes the other devices anyway so including it would create lots of duplicate menu items.</p>
<p>The last step is to restart your system.</p>
<p>Note: While your system is restarting, remove the USB device. </p>
<p>After the system restarts, Petitboot displays the option to boot CentOS 7.2. Select this option and press Enter. </p>
<h2>Conclusion</h2>
<p>After you have booted CentOS, your server is ready to go!
For more information, see the following resources:</p>
<ul>
<li><a href="https://www.ibm.com/support/knowledgecenter/">IBM Knowledge Center</a></li>
<li><a href="https://www.ibm.com/developerworks/community/groups/service/html/communityview?communityUuid=fe313521-2e95-46f2-817d-44a4f27eba32">The Linux on Power Community</a></li>
<li><a href="https://developer.ibm.com/linuxonpower/category/announcements/">The Linux on Power Developer Center</a></li>
<li><a href="https://twitter.com/ibmpowerlinux">Follow us @ibmpowerlinux</a></li>
</ul>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>